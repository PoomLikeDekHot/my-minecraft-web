<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAIKA MANAGEMENT SYSTEM | PREMIUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-color: #050505; 
            --accent-white: #ffffff; 
            --grid-color: rgba(255, 255, 255, 0.03); 
            --neon-blue: #3b82f6;
        }
        
        body { 
            font-family: 'Space Grotesk', 'Prompt', sans-serif; 
            background-color: var(--bg-color); 
            color: #a1a1aa; 
            min-height: 100vh;
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        /* --- UI Improvements --- */
        .btn-pill { 
            background: var(--accent-white); 
            color: black; 
            border-radius: 9999px; 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            font-weight: 700; 
        }
        .btn-pill:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 0 20px rgba(255,255,255,0.2); 
            opacity: 0.9; 
        }
        
        .input-dark { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            color: white; 
            border-radius: 16px; 
            padding: 14px 20px; 
            outline: none; 
            transition: all 0.3s ease; 
            font-size: 0.95rem;
        }
        .input-dark:focus { 
            border-color: var(--neon-blue); 
            background: rgba(255,255,255,0.05);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.1);
        }

        select.input-dark {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
        }
        select.input-dark option { background-color: #0a0a0a; color: white; padding: 10px; }

        /* --- New Transition Logic --- */
        .view-content { 
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); 
            opacity: 1;
            transform: translateX(0) scale(1);
        }
        .view-hidden { 
            display: none; 
            opacity: 0; 
            transform: translateX(30px) scale(0.98); 
        }
        
        /* Nav Link Glow */
        .nav-link { position: relative; }
        .nav-link::after {
            content: ''; position: absolute; bottom: -4px; left: 0; width: 0; height: 2px;
            background: var(--neon-blue); transition: 0.3s ease;
        }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .nav-link.active { color: white; }

        #custom-modal-container {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px); z-index: 10000;
            display: none; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #0d0d0d; border: 1px solid rgba(255,255,255,0.1);
            padding: 2.5rem; border-radius: 32px; width: 90%; max-width: 440px;
        }

        .stat-card {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px; padding: 1.75rem; transition: 0.3s;
        }
        .stat-card:hover { border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.04); }

        .contact-card {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px; transition: 0.3s;
        }
        .contact-card:hover { 
            background: rgba(255,255,255,0.04); transform: translateY(-5px); 
            border-color: var(--neon-blue); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.05);
        }

        #notification-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 12px; }
        .toast {
            min-width: 280px; padding: 16px 24px; border-radius: 14px; 
            background: #111; border: 1px solid rgba(255, 255, 255, 0.1); color: white;
            transform: translateX(120%); transition: 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        .toast.show { transform: translateX(0); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
    </style>
</head>
<body class="py-12 px-6">
    <div id="notification-container"></div>

    <!-- Modal ยืนยันการลบ -->
    <div id="custom-modal-container">
        <div class="modal-content text-center">
            <h4 class="text-white font-bold text-2xl mb-4">ลบรายการถาวร?</h4>
            <p class="text-gray-400 text-base mb-8">คุณแน่ใจหรือไม่ที่จะลบคิวงานลูกค้ารายนี้ออกจากระบบข้อมูล?</p>
            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 px-6 py-4 rounded-2xl border border-white/10 text-gray-400 hover:text-white transition font-semibold">ย้อนกลับ</button>
                <button id="modal-confirm-btn" class="flex-1 px-6 py-4 rounded-2xl bg-red-600 text-white font-bold hover:bg-red-500 transition shadow-lg shadow-red-900/20">ยืนยันลบ</button>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <!-- Navigation -->
        <nav class="flex flex-col lg:flex-row justify-between items-center mb-16 gap-8 px-4">
            <div class="flex items-center gap-5 cursor-pointer group" onclick="switchView('status')">
                <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center font-bold text-black text-3xl shadow-[0_0_25px_rgba(255,255,255,0.15)] group-hover:scale-105 transition">L</div>
                <div class="flex flex-col">
                    <span class="text-white font-bold italic tracking-tighter uppercase text-3xl leading-tight">Laika Shop</span>
                    <span class="text-[11px] text-blue-500 font-bold tracking-[0.5em] uppercase">Premium Service</span>
                </div>
            </div>
            <div class="flex flex-wrap justify-center items-center gap-8">
                <button onclick="switchView('status')" id="nav-status" class="nav-link text-sm uppercase tracking-[0.2em] text-gray-500 hover:text-white transition font-bold active">หน้าหลัก</button>
                <button onclick="switchView('history')" id="nav-history" class="nav-link text-sm uppercase tracking-[0.2em] text-gray-500 hover:text-white transition font-bold">ประวัติ</button>
                <button onclick="switchView('contact')" id="nav-contact" class="nav-link text-sm uppercase tracking-[0.2em] text-gray-500 hover:text-white transition font-bold">ติดต่อเรา</button>
                <div class="h-8 w-[1px] bg-white/10 hidden lg:block"></div>
                <div class="flex gap-3">
                    <input type="password" id="adminKey" placeholder="รหัสเข้าถึง" class="input-dark py-2.5 text-sm w-32 focus:w-48 transition-all">
                    <button onclick="login()" class="btn-pill px-8 py-2.5 text-[11px] uppercase">เข้าสู่ระบบ</button>
                </div>
            </div>
        </nav>

        <!-- View: Main Status -->
        <div id="statusView" class="view-content">
            <!-- Dashboard Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="stat-card">
                    <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">คิวทั้งหมด</p>
                    <h3 id="stat-total" class="text-5xl font-bold text-white leading-none">0</h3>
                </div>
                <div class="stat-card border-l-4 border-l-yellow-500/50">
                    <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">กำลังดำเนินการ</p>
                    <h3 id="stat-farming" class="text-5xl font-bold text-yellow-400 leading-none">0</h3>
                </div>
                <div class="stat-card border-l-4 border-l-green-500/50">
                    <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">สำเร็จแล้ว</p>
                    <h3 id="stat-done" class="text-5xl font-bold text-green-400 leading-none">0</h3>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="hidden mb-16 p-8 md:p-12 rounded-[40px] bg-white/[0.01] border border-white/5 backdrop-blur-2xl">
                <div class="flex items-center gap-3 mb-10">
                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse shadow-[0_0_12px_#3b82f6]"></div>
                    <h2 class="text-white text-xs font-bold tracking-[0.3em] uppercase opacity-80">แผงควบคุมผู้ดูแลระบบ</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <input type="text" id="custName" placeholder="ระบุชื่อลูกค้า" class="input-dark font-medium">
                    <select id="gameMap" class="input-dark cursor-pointer font-medium">
                        <option value="" disabled selected>เลือกประเภทงาน / เกม</option>
                        <option value="The Forge">The Forge</option>
                        <option value="Anime Vanguard">Anime Vanguard</option>
                        <option value="Blox Fruit">Blox Fruit</option>
                        <option value="Other Games">อื่นๆ</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                    <input type="text" id="custDetail" placeholder="รายละเอียดการฟาร์ม (เช่น เลเวล, ไอเทม)" class="input-dark font-medium">
                    <input type="text" id="imgUrl" placeholder="ลิงก์รูปภาพประกอบ (ใส่ URL หรือเว้นว่าง)" class="input-dark font-medium">
                </div>
                <button onclick="addNewQueue()" class="btn-pill w-full py-5 text-sm uppercase tracking-[0.3em]">เพิ่มข้อมูลลงในระบบแบบสด</button>
            </div>

            <!-- Table Section -->
            <div class="px-2">
                <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-6">
                    <div>
                        <h3 class="text-white font-bold text-xl tracking-[0.1em] uppercase">คิวที่กำลังดำเนินการ</h3>
                        <p class="text-xs text-gray-600 font-mono tracking-widest mt-2 uppercase">Status: Live Monitoring</p>
                    </div>
                    <div class="relative w-full md:w-80">
                        <input type="text" id="searchQueue" oninput="renderData()" placeholder="ค้นหาชื่อลูกค้า/งาน..." class="input-dark w-full py-3.5 text-sm">
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-separate border-spacing-y-4">
                        <thead>
                            <tr class="text-xs uppercase tracking-[0.2em] text-gray-500 font-bold">
                                <th class="pb-2 px-6">งาน / เกม</th>
                                <th class="pb-2">ลูกค้า</th>
                                <th class="pb-2">รายละเอียด</th>
                                <th class="pb-2 text-center">สถานะ</th>
                                <th id="delHeader" class="hidden pb-2" width="100">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="dataList"></tbody>
                    </table>
                </div>
                <div id="emptyState" class="hidden py-24 text-center">
                    <p class="text-gray-600 text-lg italic font-medium">ไม่พบข้อมูลคิวงานที่กำลังดำเนินการ...</p>
                </div>
            </div>
        </div>

        <!-- View: History (New Feature) -->
        <div id="historyView" class="view-content view-hidden">
            <div class="px-2">
                <div class="text-center mb-16">
                    <h2 class="text-white text-5xl font-bold tracking-tight mb-6 italic uppercase">HISTORY</h2>
                    <p class="text-gray-400 text-lg tracking-wide">ประวัติการฟาร์มที่เสร็จสิ้นสมบูรณ์แล้วทั้งหมด</p>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-separate border-spacing-y-4">
                        <thead>
                            <tr class="text-xs uppercase tracking-[0.2em] text-gray-500 font-bold">
                                <th class="pb-2 px-6">งานที่สำเร็จ</th>
                                <th class="pb-2">ชื่อลูกค้า</th>
                                <th class="pb-2">รายละเอียดงาน</th>
                                <th class="pb-2 text-center">สถานะล่าสุด</th>
                                <th id="delHeaderHistory" class="hidden pb-2" width="100">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="historyList"></tbody>
                    </table>
                </div>
                <div id="emptyStateHistory" class="hidden py-24 text-center">
                    <p class="text-gray-600 text-lg italic font-medium">ยังไม่มีประวัติการฟาร์มที่เสร็จสิ้น...</p>
                </div>
            </div>
        </div>

        <!-- View: Contact -->
        <div id="contactView" class="view-content view-hidden max-w-5xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-white text-5xl font-bold tracking-tight mb-6">ติดต่อเรา</h2>
                <p class="text-gray-400 text-lg tracking-wide">ช่องทางการสื่อสารหลักสำหรับบริการ Laika Shop</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <a href="https://www.facebook.com/natthaseth.seethapon" target="_blank" class="contact-card p-10 text-center group">
                    <div class="w-20 h-20 bg-blue-600/10 rounded-3xl flex items-center justify-center mx-auto mb-8 border border-blue-500/20 group-hover:bg-blue-600/20 transition">
                        <svg class="w-10 h-10 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.469h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                    </div>
                    <h4 class="text-white font-bold text-lg mb-2">เฟซบุ๊กแอดมิน</h4>
                    <p class="text-xs text-gray-500 uppercase tracking-widest font-semibold">Natthaseth Seethapon</p>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61572258972880" target="_blank" class="contact-card p-10 text-center group">
                    <div class="w-20 h-20 bg-white/5 rounded-3xl flex items-center justify-center mx-auto mb-8 border border-white/10 group-hover:bg-white/10 transition">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12c0-5.523-4.477-10-10-10z"/></svg>
                    </div>
                    <h4 class="text-white font-bold text-lg mb-2">หน้าเพจร้าน</h4>
                    <p class="text-xs text-gray-500 uppercase tracking-widest font-semibold">Laika Shop</p>
                </a>
                <div class="contact-card p-10 text-center group cursor-pointer" onclick="copyDiscordID()">
                    <div class="w-20 h-20 bg-indigo-600/10 rounded-3xl flex items-center justify-center mx-auto mb-8 border border-indigo-500/20 group-hover:bg-indigo-600/20 transition">
                        <svg class="w-10 h-10 text-indigo-500" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.862-1.297 1.197-1.99a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.863-.886.077.077 0 0 1-.008-.128c.125-.094.248-.192.366-.292a.077.077 0 0 1 .081-.01c3.901 1.787 8.124 1.787 11.968 0a.075.075 0 0 1 .081.01c.118.1.241.198.366.292a.077.077 0 0 1-.008.128 12.212 12.212 0 0 1-1.863.886.076.076 0 0 0-.041.106c.335.693.735 1.36 1.197 1.99a.078.078 0 0 0 .084.028 19.83 19.83 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
                    </div>
                    <h4 class="text-white font-bold text-lg mb-2">ดิสคอร์ด (คัดลอก)</h4>
                    <p id="discordID" class="text-[11px] text-indigo-400 font-mono tracking-widest bg-white/5 px-3 py-1.5 rounded font-bold">756871637625864302</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyA50p8gXK-BUm6C4jzD7OZpaz2jdRCKHUQ",
            authDomain: "laikashop-c43bd.firebaseapp.com",
            databaseURL: "https://laikashop-c43bd-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "laikashop-c43bd",
            storageBucket: "laikashop-c43bd.firebasestorage.app",
            messagingSenderId: "955266408750",
            appId: "1:955266408750:web:1ef4dfca18756c49d15abf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let isAdmin = false;
        let cachedData = {};

        // --- Improved View Controller with Slide-Fade Transition ---
        function switchView(viewName) {
            const views = {
                status: document.getElementById('statusView'),
                history: document.getElementById('historyView'),
                contact: document.getElementById('contactView')
            };
            const navs = {
                status: document.getElementById('nav-status'),
                history: document.getElementById('nav-history'),
                contact: document.getElementById('nav-contact')
            };

            // Reset all
            Object.values(views).forEach(v => {
                v.classList.add('view-hidden');
            });
            Object.values(navs).forEach(n => n.classList.remove('active'));

            // Set active
            const activeView = views[viewName];
            activeView.classList.remove('view-hidden');
            navs[viewName].classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Notification ---
        function notify(msg, type = 'success') {
            const container = document.getElementById('notification-container');
            const toast = document.createElement('div');
            toast.className = `toast show`;
            toast.style.borderLeft = type === 'success' ? '5px solid #3b82f6' : '5px solid #ef4444';
            toast.innerHTML = `<span class="text-sm font-bold tracking-wide">${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // --- Modal System ---
        function showConfirm(callback) {
            const modal = document.getElementById('custom-modal-container');
            modal.style.display = 'flex';
            document.getElementById('modal-confirm-btn').onclick = () => {
                callback();
                closeModal();
            };
        }
        function closeModal() { document.getElementById('custom-modal-container').style.display = 'none'; }

        // --- Copy Discord ID ---
        function copyDiscordID() {
            const id = document.getElementById('discordID').innerText;
            const tempInput = document.createElement('input');
            tempInput.value = id;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            notify("คัดลอก ID ดิสคอร์ดลงเครื่องแล้ว!");
        }

        // --- Admin Logic ---
        function login() {
            const key = document.getElementById('adminKey').value;
            if(key === "0804141441z") {
                isAdmin = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('delHeader').classList.remove('hidden');
                document.getElementById('delHeaderHistory').classList.remove('hidden');
                notify("ยินดีต้อนรับ แอดมินเข้าสู่ระบบสำเร็จ");
                renderData();
            } else { notify("รหัสเข้าถึงไม่ถูกต้อง กรุณาลองใหม่", "error"); }
        }

        function addNewQueue() {
            const name = document.getElementById('custName').value;
            const game = document.getElementById('gameMap').value;
            if(!name || !game) return notify("กรุณากรอกข้อมูลให้ครบถ้วนก่อนบันทึก", "error");

            db.ref('jobs').push().set({
                name, game,
                detail: document.getElementById('custDetail').value,
                img: document.getElementById('imgUrl').value || 'https://via.placeholder.com/150/111/fff?text=LAIKA',
                status: 'รอคิว',
                timestamp: Date.now()
            });
            notify("บันทึกคิวงานใหม่เข้าระบบสำเร็จ");
            ['custName','custDetail','imgUrl'].forEach(id => document.getElementById(id).value = '');
        }

        // --- Render Logic (Splitting Active and History) ---
        function renderData() {
            const activeList = document.getElementById('dataList');
            const historyList = document.getElementById('historyList');
            const search = document.getElementById('searchQueue').value.toLowerCase();
            
            let activeHtml = '';
            let historyHtml = '';
            
            let stats = { total: 0, farming: 0, done: 0 };
            let hasActive = false;
            let hasHistory = false;

            if (cachedData) {
                const entries = Object.entries(cachedData).sort((a,b) => b[1].timestamp - a[1].timestamp);
                
                entries.forEach(([id, val]) => {
                    stats.total++;
                    if(val.status === 'กำลังฟาร์ม') stats.farming++;
                    if(val.status === 'เสร็จสิ้น') stats.done++;

                    const isMatch = val.name.toLowerCase().includes(search) || val.game.toLowerCase().includes(search);
                    
                    const rowContent = `
                        <tr class="bg-white/[0.03] border border-white/5 group hover:bg-white/[0.06] hover:shadow-[0_0_25px_rgba(59,130,246,0.08)] transition-all">
                            <td class="py-6 px-6 rounded-l-2xl">
                                <div class="flex items-center gap-5">
                                    <img src="${val.img}" onerror="this.src='https://via.placeholder.com/150/111/fff?text=LAIKA'" class="w-14 h-14 rounded-xl object-cover border border-white/10 shadow-xl">
                                    <span class="text-white font-bold text-lg">${val.game}</span>
                                </div>
                            </td>
                            <td class="py-6 text-gray-100 font-bold text-base">${val.name}</td>
                            <td class="py-6 text-gray-400 text-sm font-medium leading-relaxed">${val.detail || '-'}</td>
                            <td class="py-6 text-center">
                                ${isAdmin ? `
                                    <select onchange="updateStatus('${id}', this.value)" class="bg-black border border-white/20 text-xs rounded-xl p-2.5 text-white outline-none focus:border-blue-500 font-bold">
                                        <option value="รอคิว" ${val.status==='รอคิว'?'selected':''}>รอคิว</option>
                                        <option value="กำลังฟาร์ม" ${val.status==='กำลังฟาร์ม'?'selected':''}>กำลังฟาร์ม</option>
                                        <option value="เสร็จสิ้น" ${val.status==='เสร็จสิ้น'?'selected':''}>เสร็จสิ้น</option>
                                    </select>
                                ` : `
                                    <span class="px-6 py-2 rounded-full text-[11px] font-bold border uppercase tracking-widest shadow-sm ${val.status === 'เสร็จสิ้น' ? 'text-green-400 border-green-500/30 bg-green-500/10' : (val.status === 'กำลังฟาร์ม' ? 'text-yellow-400 border-yellow-500/30 bg-yellow-500/10' : 'text-blue-400 border-blue-500/30 bg-blue-500/10')}">${val.status}</span>
                                `}
                            </td>
                            ${isAdmin ? `<td class="py-6 px-8 text-right rounded-r-2xl"><button onclick="deleteJob('${id}')" class="w-10 h-10 rounded-full hover:bg-red-500/20 text-gray-700 hover:text-red-500 transition-all opacity-0 group-hover:opacity-100 flex items-center justify-center font-bold text-xl">✕</button></td>` : ''}
                        </tr>`;

                    if (val.status === 'เสร็จสิ้น') {
                        historyHtml += rowContent;
                        hasHistory = true;
                    } else if (isMatch) {
                        activeHtml += rowContent;
                        hasActive = true;
                    }
                });
            }

            // Stats Update
            document.getElementById('stat-total').innerText = stats.total;
            document.getElementById('stat-farming').innerText = stats.farming;
            document.getElementById('stat-done').innerText = stats.done;

            // Render Active
            activeList.innerHTML = activeHtml;
            document.getElementById('emptyState').style.display = hasActive ? 'none' : 'block';

            // Render History
            historyList.innerHTML = historyHtml;
            document.getElementById('emptyStateHistory').style.display = hasHistory ? 'none' : 'block';
        }

        function loadData() {
            db.ref('jobs').on('value', (snapshot) => {
                cachedData = snapshot.val() || {};
                renderData();
            });
        }

        function updateStatus(id, newStatus) { 
            db.ref('jobs/' + id).update({ status: newStatus }); 
            if(newStatus === 'เสร็จสิ้น') {
                notify("งานสำเร็จแล้ว! ย้ายไปที่หน้าประวัติการฟาร์ม");
            } else {
                notify(`อัปเดตสถานะเป็น: ${newStatus}`);
            }
        }

        function deleteJob(id) { 
            showConfirm(() => { 
                db.ref('jobs/' + id).remove(); 
                notify("ลบรายการออกจากฐานข้อมูลแล้ว", "error"); 
            }); 
        }

        loadData();
    </script>
</body>
</html>
